# 全运会帆船比赛海流预测

## 📖 项目背景
本项目的目标是对 **第十五届全运会帆船比赛场地**（10 月 20–30 日）13 个固定观测站点（S1–S13）的 **海流速度和方向** 进行预测。  
在帆船比赛中，**海流的强度和流向** 是影响运动员战术选择和比赛成绩的关键环境因素，因此需要在 **白天比赛时段** 提供尽可能精确的预报结果。

本项目使用了三类核心数据源：
- **实测海流数据**：来自 S1–S13 站点的实测流速与流向。  
- **官方潮位数据**：由附近验潮站提供，连续、高分辨率（10 分钟或 1 小时）。  
- **潮汐表（稀疏观测）**：每天约 4 个点（2 次高潮、2 次低潮），直接针对比赛海域。  

关键挑战在于：如何将 **密集但非局地的官方潮位** 与 **稀疏但局地的潮汐表** 有机结合，以获得 **稳健、准确的海流预测**。

---

## ⚙️ 方法

### 1. 数据处理
- **海流观测数据**  
  - 将流速（cm/min）与流向（来向 → 去向）统一转换为分量 (u,v)。  
  - 通过 Hampel 滤波器剔除异常值。  
  - 重采样至 1 小时间隔，并在 u,v 空间内进行短缺失插值。  

- **官方潮位数据**  
  - 重采样至整点，并用时间插值补齐。  
  - 进行 5 点滑动平均，降低噪声。  

- **潮汐表数据**  
  - 稀疏（每日约 4 点），无法直接插值。  
  - 作为局地锚点，用于校准分潮模型。  

### 2. 潮位重构（官方 + 潮汐表融合）
- 对官方潮位 `η_off` 进行 **主要分潮（M2、S2、K1、O1、SN）拟合**，得到连续骨架。  
- 在潮汐表时刻，对应解算：
  - **c**：基准面偏置；  
  - **s**：整体振幅缩放；  
  - **Δ**：各分潮的微调系数（正则化约束）。  
- 得到局地潮位：
  \[
  \eta_{\text{loc}}(t) = c + s \cdot \eta_{\text{off}}(t) + \sum \Delta \cos/\sin(\omega t)
  \]
- 对 `η_loc` 做 **解析求导** 得到 `dη_loc/dt`（潮坡），避免差分放大噪声。  

### 3. 特征工程
- 潮汐驱动：`η_loc`、`dη_loc/dt`、|dη|、涨/落潮标记、转流门控（±90 分钟）。  
- 标准化：因果滑动均值/方差（避免信息泄露）。  
- 差异特征：`η_loc − η_off`，`dη_loc − dη_off`。  
- 自回归特征：u,v 的 1–3 步滞后与滑动均值。  
- 空间特征：相邻站点（±1）的 lag-1 平均。  

### 4. 模型设计
- **流速预测（|u,v|）**  
  - 使用线性基线模型（η_loc, dη_loc/dt 及其交互）。  
  - 能稳定达到 MAE ≈ 0.1 m/s。  

- **流向预测（角度）**  
  - **两层结构**：  
    1. 谐波骨架（按 |dη| 加权，弱化转流时刻）。  
    2. 残差校正（Ridge 回归，输入潮汐 + AR + 空间特征，分洪/落潮）。  
  - 严格滚动验证（strict one-step，stride = 12 小时）。  

### 5. 评估指标
- **方向 MAE**：整体、强流窗口（|dη| ≥ 中位数）、|dη| 加权。  
- **速度 MAE / RMSE**。  
- **命中率**：(|Δspeed| ≤ 0.2 m/s 且 |Δdir| ≤ 20°)。  

结果表明：
- 流速预测误差稳定在 ~0.1 m/s。  
- 流向预测整体 MAE 从 50–60° 降至 40–50°。  
- 在强流时段，加权方向 MAE 可降低至 12–16°，对比赛策略具有实际指导意义。  

---

## 📂 仓库结构
